{
  "complexity": "standard",
  "workflow_type": "feature",
  "confidence": 0.85,
  "reasoning": "Translation task converting well-documented SQL schemas to SQLAlchemy models. While scope is significant (~70 tables across 6 schema files), patterns are standard (SQLAlchemy/Alembic pre-configured), no external integrations needed, and detailed SQL CREATE statements provided. Risk is migration ordering with complex FK relationships.",

  "analysis": {
    "scope": {
      "estimated_files": 12,
      "estimated_services": 1,
      "is_cross_cutting": false,
      "notes": "~70 tables across 6 schema domains requiring 8-12 model files. Domains: process (~18 tables), storyteller (~12 tables), session (~6 tables), collection (~7 tables), story (~11 tables), system_operations (~13 tables). All within app/database/ directory."
    },
    "integrations": {
      "external_services": [],
      "new_dependencies": [],
      "research_needed": false,
      "notes": "No external integrations. SQLAlchemy and Alembic are already in use with existing patterns in event.py. PostgreSQL-specific types (UUID, ARRAY, JSONB) are already demonstrated."
    },
    "infrastructure": {
      "docker_changes": false,
      "database_changes": true,
      "config_changes": false,
      "notes": "Database schema changes via Alembic migrations (the intended outcome). Docker/Supabase already running. No configuration changes needed - Alembic is pre-configured."
    },
    "knowledge": {
      "patterns_exist": true,
      "research_required": false,
      "unfamiliar_tech": [],
      "notes": "Clear model pattern in event.py: UUID primary keys, datetime handling, JSON columns, proper imports from database.session.Base. Schema docs are well-structured SQL with clear table definitions."
    },
    "risk": {
      "level": "medium",
      "concerns": [
        "~70 tables with complex FK relationships require correct migration ordering",
        "Self-referential FKs (e.g., process_section.unlock_after_section_id, archetype_analysis.previous_analysis_id)",
        "Polymorphic references (e.g., user_feedback.feedback_on_id references multiple tables)",
        "PostgreSQL-specific types (ARRAY, JSONB) need correct SQLAlchemy dialect imports",
        "May need multiple migration files for proper dependency resolution"
      ],
      "notes": "New tables only - no modification of existing events table. Risk is primarily ordering and FK constraints. Well-documented schemas reduce implementation ambiguity."
    }
  },

  "recommended_phases": [
    "discovery",
    "requirements",
    "context",
    "spec_writing",
    "planning",
    "validation"
  ],

  "flags": {
    "needs_research": false,
    "needs_self_critique": false,
    "needs_infrastructure_setup": false
  },

  "validation_recommendations": {
    "risk_level": "medium",
    "skip_validation": false,
    "minimal_mode": false,
    "test_types_required": ["unit", "integration"],
    "security_scan_required": false,
    "staging_deployment_required": false,
    "reasoning": "Database schema changes require integration tests to verify migrations run successfully and tables are created correctly. Unit tests for model definitions. No security concerns as this is internal schema generation with no auth/payment code."
  },

  "task_specifics": {
    "schema_files": [
      "ai_docs/context/source_docs/schema/process_schema.md",
      "ai_docs/context/source_docs/schema/storyteller_schema.md",
      "ai_docs/context/source_docs/schema/session_schema.md",
      "ai_docs/context/source_docs/schema/collection_schema.md",
      "ai_docs/context/source_docs/schema/story_schema.md",
      "ai_docs/context/source_docs/schema/system_operations_schema.md"
    ],
    "target_directory": "app/database/",
    "existing_patterns": "app/database/event.py",
    "migration_scripts": ["app/makemigration.sh", "app/migrate.sh"],
    "estimated_model_count": "~70",
    "table_counts_by_domain": {
      "process_schema": 18,
      "storyteller_schema": 12,
      "session_schema": 6,
      "collection_schema": 7,
      "story_schema": 11,
      "system_operations_schema": 13
    },
    "key_model_domains": [
      "Process (process_version, process_node, process_flow_edge, process_section, process_prompt, session, session_scope, session_profile, session_progress)",
      "Storyteller (storyteller, storyteller_boundary, storyteller_preference, life_event, life_event_timespan, life_event_location, life_event_participant, life_event_detail, life_event_trauma, life_event_boundary, life_event_media)",
      "Session (session, session_life_event, session_interaction, session_artifact, session_template, session_note)",
      "Collection (collection, collection_life_event, collection_grouping, collection_grouping_member, collection_relationship, collection_tag, collection_synthesis)",
      "Story (story, story_chapter, chapter_section, story_collection, story_character, character_relationship, character_appearance, story_theme, chapter_theme, story_scene, story_draft)",
      "Operations (storyteller_progress, storyteller_section_selection, storyteller_section_status, scope_type, archetype_analysis, user_feedback, agent, agent_instance, requirement, edit_requirement, book_export, book_export_delivery)"
    ],
    "migration_ordering_notes": {
      "tier_1_no_fks": ["process_version", "process_node_type", "storyteller", "agent", "scope_type", "prompt_pack_template"],
      "tier_2_simple_fks": ["process_commitment", "process_node", "process_section", "storyteller_boundary", "storyteller_preference", "storyteller_progress", "life_event"],
      "tier_3_complex_fks": ["session", "collection", "story", "life_event children", "session children"],
      "tier_4_junction_tables": ["session_life_event", "collection_life_event", "story_collection", "chapter_theme", "character_appearance"]
    },
    "postgresql_specific_types": ["UUID (as_uuid=True)", "ARRAY (postgresql.ARRAY)", "JSONB (postgresql.JSONB)", "TEXT[]"]
  },

  "created_at": "2024-12-21T12:00:00Z"
}
